<!DOCTYPE html>
<html>
  <head>
    <title>Warband Editor</title>
    <style>
      table, th, td { border: 1px solid black; text-align: left; }
    </style>
  </head>
  <body>

    <h1>Warband</h1>
    <h2>Warband Name:<input type="text" id="bandnametext" name="bandnametext" value="{{ band['Name'] }}"></h2>

    <table border="0">
      <tr>
        <td><h3>Currency remaining: </h3></td>
        <td id='remainingGold'>{{ band['Treasury'] }}</td>
        <td><h3>Add Currency:</h3></td>
        <td><input id="add_currency" type="number" value="0" onclick="updateCost()"></td>
      </tr>
    </table>
    <table id="captainTable">
      <tr>
        <td>Move</td>
        <td>Fight</td>
        <td>Shoot</td>
        <td>Shield</td>
        <td>Morale</td>
        <td>Health</td>
        <td>Specialism</td>
        <td>Weapons and Equipment</td>
        <td>Skills</td>
        <td>Experience</td>
      </tr>
      <tr>

        <td>5</td>
        <td><input id="capfig" type="number" max="8"  value="{{band['Captain']['Fight']}}"></td>
        <td><input id="capsho" type="number" max="8"  value="{{band['Captain']['Shoot']}}"></td>
        <td>12</td>
        <td><input id="capmor" type="number" max="8"  value="{{band['Captain']['Morale']}}"></td>
        <td><input id="caphea" type="number" max="20" value="{{band['Captain']['Health']}}"></td>

        <td><select id="capspecsel" onchange="setCapSkillchoice(this)" disabled>
          <option value="Empty">Select...</option>
          {% for spec in specs %}
          {% if spec == band['Captain']['Specialism']: %}
          <option value="{{ spec }}" selected>{{ spec }}</option>
          {% else %}
          <option value="{{ spec }}">{{ spec }}</option>
          {% endif %}
          {% endfor %}
          </select></td>
        <td>
            {% for weap in weaps %}
            <input type="checkbox" id="{{weap}}_check" onclick="updateCost()" value="{{weap}}">{{weap}}<br>
            {% endfor %}
          </select>
        </td>
        <td>
          {% for opt in skills[band['Captain']['Specialism']] %}
          {% if opt in band['Captain']['Skillset'] %}
          <input type="checkbox"  name="capskil" value="{{opt}}" checked>{{opt}}
          {% else %}
          <input type="checkbox" name="capskil"  value="{{opt}}">{{opt}}
          {% endif %}
          {% endfor %}
        </td>
        <td><input id="capexp" type="number" value="{{band['Captain']['Experience']}}"/></td>
      </tr>









    </table>
    Hire ensign? <input type="checkbox" name="ensign_hire" id="ensign_hire" onClick="toggle_ensign()" {% if 'Ensign' in band.keys() %} checked {%endif%}>250gc<br>


  {% if 'Ensign' in band.keys() %}
  <div id="ensignDiv" style='display: block'>

  {%else%}
  <div id="ensignDiv" style='display: none'>
  {%endif%}

        <table id="ensignTable">
          <tr>
            <td>Move</td>
            <td>Fight</td>
            <td>Shoot</td>
            <td>Shield</td>
            <td>Morale</td>
            <td>Health</td>
            <td>Specialism</td>
            <td>Weapons and Equipment</td>
            <td>Skills</td>
            <td>Experience</td>

          </tr>
          {% if 'Ensign' in band.keys() %}
          <tr>

            <td>7</td>
            <td><input id="enfig" type="number" max="6" value="{{band['Ensign']['Fight']}}"></td>
            <td><input id="ensho" type="number" max="6"value="{{band['Ensign']['Shoot']}}"></td>
            <td>10</td>
            <td><input id="enmor" type="number" max="4" value="{{band['Ensign']['Morale']}}"></td>
            <td><input id="enhea" type="number" max="16" value="{{band['Ensign']['Health']}}"></td>
            <td><select id="ensskillsel" onchange="setEnsSkillchoice(this)" disabled>
              <option value="Empty">Select...</option>
              {% for spec in specs %}

              {% if spec == band['Ensign']['Specialism']: %}
              <option value="{{ spec }}" selected>{{ spec }}</option>
              {% else %}
              <option value="{{ spec }}">{{ spec }}</option>
              {% endif %}
              {% endfor %}
            </select>
            </td>

        <td>
            {% for weap in weaps %}
            <input type="checkbox" id="{{weap}}_ens_check" onclick="updateCost()" balue="{{weap}}">{{weap}}<br>
            {% endfor %}
            </select>
          </td>

            <td>
              {% for opt in skills[band['Ensign']['Specialism']] %}
              {% if opt in band['Ensign']['Skillset'] %}
              <input type="checkbox" name="ensskil"  value="{{opt}}" checked>{{opt}}
              {% else %}
              <input type="checkbox" name="ensskil"  value="{{opt}}">{{opt}}
              {% endif %}
              {% endfor %}
            </td>
            <td><input id="enexp" type="number" value="{{band['Ensign']['Experience']}}"/></td>

          </tr>
          {% else %}
          <tr>
            <td>{{ensign['Ensign']['Move']}}</td>
            <td>{{ensign['Ensign']['Fight']}}</td>
            <td>{{ensign['Ensign']['Shoot']}}</td>
            <td>{{ensign['Ensign']['Shield']}}</td>
            <td>{{ensign['Ensign']['Morale']}}</td>
            <td>{{ensign['Ensign']['Health']}}</td>
            <td>
              <select id="ensskillsel" onchange="setEnsSkillchoice(this)">
                <option value="Empty">Select...</option>
                {% for spec in specs %}

                {% if spec == ensign['Ensign']['Specialism']: %}
                <option value="{{ spec }}" selected>{{ spec }}</option>
                {% else %}
                <option value="{{ spec }}">{{ spec }}</option>
                {% endif %}
                {% endfor %}
              </select>

                      <td>
            {% for weap in weaps %}
            <input type="checkbox" id="{{weap}}_ens_check" onclick="updateCost()" value="{{weap}}">{{weap}}<br>
            {% endfor %}
            </select>
          </td>

            </td>
            <td></td>
            <td><input id="ensexp" type="number" value="{{ensign['Ensign']['Experience']}}"/></td>

          </tr>

          {% endif %}





        </table>
      </div>
      <table id='rosterTable'>
        <tr>
          <td>Class</td>
          <td>Move</td>
          <td>Fight</td>
          <td>Shoot</td>
          <td>Shield</td>
          <td>Morale</td>
          <td>Health</td>
          <td>Cost</td>
          <td>Notes</td>
        </tr>

        {% set p = 1 %}
        {% for trooper in band['Troops'] %}
        <tr>
          <td>
            <select id="troop{{p}}" onchange="updateTableRow({{ p }}, this)">
              <option value="Empty">Empty</option>
              {% for troop in people.keys() %}
              {% if troop == trooper: %}
              <option value="{{ troop }}" selected >{{ troop }}</option>
              {% else %}
              <option value="{{ troop }}" >{{ troop }}</option>
              {% endif %}
              {% endfor %}
            </select>
          </td>
          <td>{{ people[trooper]['Move'] }}</td>
          <td>{{ people[trooper]['Fight'] }}</td>
          <td>{{ people[trooper]['Shoot'] }}</td>
          <td>{{ people[trooper]['Shield'] }}</td>
          <td>{{ people[trooper]['Morale'] }}</td>
          <td>{{ people[trooper]['Health'] }}</td>
          <td>{{ people[trooper]['Cost'] }}</td>
          <td>{{ people[trooper]['Notes'] }}</td>
        </tr>
        {% set p = p + 1 %}
        {% endfor %}
        {% for i in range((band['Troops']|length)+1,9) %}
        <tr>
          <td>
            <select id="troop{{i}}" onchange="updateTableRow({{ i }}, this)">
              <option value="Empty">Empty</option>
              {% for troop in people.keys() %}
              <option value="{{ troop }}">{{ troop }}</option>
              {% endfor %}
            </select>
          </td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>0</td>
          <td>-</td>
        </tr>
        {% endfor %}
      </table>
      <input id="creator" type="button" value="Create Warband" onclick="doFormSubmit(total);" />
      <input id="cancel" type="button" value="Cancel" onclick="window.location.href='/edit'" />
      </div>
      </body>




    <script type="text/javascript">
      var total = {{ band['Treasury'] }};

      var captain_skill = {{ band['Captain']['Skillset'] }};
      var ensign_skill = {{ band['Ensign']['Skillset'] }};
      console.log(captain_skill);
      console.log(ensign_skill);


      {% if 'Ensign' in band.keys():  %}
      var engHire = true;
       var hadEnsign = true;
      {%else%}
      var engHire = false;
       var hadEnsign = false;
      {% endif %}

      toggle_ensign()

          function toggle_ensign()
    {
        //if ensign exists
        if(document.getElementById('ensign_hire').checked)
        {
        engHire = true
        document.getElementById('ensignDiv').style='display: block'
        }


        //if ensign does not exist
        if(document.getElementById('ensign_hire').checked == false)
        {
        engHire = false
        document.getElementById('ensignDiv').style='display: none'
        }

        updateCost()

    }



      //get captains weaponry, fill checkboxes accordingly
      captain_weapons = ["{{ band['capweap']|join("\",\"")|safe }}"]
      for (i=0; i<captain_weapons.length; i++)
      {
        weapon = captain_weapons[i];

        if(document.getElementById(weapon + "_check").checked !== null)
        {
          document.getElementById(weapon + "_check").checked = true;
        }
      }


      //get ensign weaponry, fill checkboxes accordingly
      if(engHire == true)
      {
        ensign_weapons = ["{{ band['ensweap']|join("\",\"")|safe }}"]
        for (i=0; i<ensign_weapons.length; i++)
        {

          weapon = ensign_weapons[i];

          if(document.getElementById(weapon + "_ens_check"))
          {
            document.getElementById(weapon + "_ens_check").checked = true;

          }
        }
      }


    function hireEng()
       {
         //show ensign
         if(document.getElementById('ensign_hire').checked)
         {
           engHire = true;
           document.getElementById("ensignDiv").style.display = "block";
           updateCost();
         }
         //don't show ensign
         else
         {
           engHire = false;
           document.getElementById("ensignDiv").style.display = "hidden";
           updateCost();
         }
       }



   //occurs on troop change
   function updateTableRow(row, x)
   {
     var sel = x.value;

     var myTable = document.getElementById('rosterTable');

     //if troop fired (NO REFUND)
     if(sel == "Empty")
     {
       myTable.rows[row].cells[1].innerHTML = '-';
       myTable.rows[row].cells[2].innerHTML = '-';
       myTable.rows[row].cells[3].innerHTML = '-';
       myTable.rows[row].cells[4].innerHTML = '-';
       myTable.rows[row].cells[5].innerHTML = '-'
       myTable.rows[row].cells[6].innerHTML = '-';
       myTable.rows[row].cells[7].innerHTML = 0;
       myTable.rows[row].cells[8].innerHTML = '-';
     }

     //if troop hired
     {% for troop in people.keys() %}
     if(sel == "{{troop}}")
     {
       myTable.rows[row].cells[1].innerHTML = '{{ people[troop]['Move'] }}';
       myTable.rows[row].cells[2].innerHTML = '{{ people[troop]['Fight'] }}';
       myTable.rows[row].cells[3].innerHTML = '{{ people[troop]['Shoot'] }}';
       myTable.rows[row].cells[4].innerHTML = '{{ people[troop]['Shield'] }}';
       myTable.rows[row].cells[5].innerHTML = '{{ people[troop]['Morale'] }}';
       myTable.rows[row].cells[6].innerHTML = '{{ people[troop]['Health'] }}';
       myTable.rows[row].cells[7].innerHTML = {{ people[troop]['Cost'] }};
       myTable.rows[row].cells[8].innerHTML = '{{ people[troop]['Notes'] }}';

     }
     {% endfor %}
     updateCost();
     }


       updateCost()


   function updateCost()
   {

   console.log('STARTING UPDATECOST');
     var sum = 0;
     var myTable = ["{{ people|join("\",\"")|safe }}"]

        //ensign hire cost
        //most cases do nothing; here to test various refund mechanisms

        if(engHire && hadEnsign)
        {}

        if(engHire && !(hadEnsign))
        {
         sum += 250;
        }

        if(!(engHire) && hadEnsign)
        {}

        if(!(engHire) && !(hadEnsign))
        {}

        //troop cost

          //sum up cost of 8 troops
          for(i = 1; i <= 8; i++)
          {
            sum += parseInt(rosterTable.rows[i].cells[7].innerHTML);
          }


           //apparently the whole people=app.troops thing REFUSES TO OBEY ITS MASTER
           //so here's a new dictionary one can actually [expletive] access
           //I'm fully aware that it's bad practice, and at this point I really don't care
           troop_costs = {'Augment Gorilla': 20, 'Lackey': 20, 'Security':  80, 'Engineer':60, 'Medic': 50, 'Commando':  100, 'Combat Droid': 150,}


          //sum up cost of initial troops (avoid double counting)
          initial_troops = ["{{ band['Troops']|join("\",\"")|safe }}"];
          if(initial_troops[0] !== "")
          {
          for(i=0; i<initial_troops.length; i++)
          {
          troop = initial_troops[i]
          sum -= troop_costs[troop]
          }
          }

        //sum up item costs

        //initial weapons loadout
        initial_weapons = ["{{ band['capweap']|join("\",\"")|safe }}"]
        initial_ens_weapons = ["{{ band['ensweap']|join("\",\"")|safe }}"]

        {% for weap in weaps %}
        {

          //subtract if currently possessed by captain
          if(document.getElementById("{{weap}}_check").checked)
          {
          sum += {{weaps[weap]}};
          }

          //add if initially possessed by captain (avoids double-counting)
          if(initial_weapons.indexOf("{{weap}}") >= 0)
          {
          sum -= {{weaps[weap]}};
          }


          //subtract if currently possessed by ensign
          if(document.getElementById("{{weap}}_ens_check").checked)
          {
           sum += {{weaps[weap]}};
          }

          //add if initially posses by ensign (avoids double-counting)
          if(initial_ens_weapons.indexOf("{{weap}}") >= 0)
          {
          sum -= {{weaps[weap]}};
          }

        }

        {% endfor %}


    total = {{band['Treasury']}} - sum + parseInt(document.getElementById('add_currency').value);
    remainingGold.innerHTML = total;

    console.log(sum);
    console.log(total);
    console.log({{band['Treasury']}});
   }




   function setCapSkillchoice(x)
   {
     var choice = x.value;
     var myTable = document.getElementById('captainTable');
     var list = myTable.rows[1].cells[8];
     while (list.hasChildNodes()) {
       list.removeChild(list.firstChild);
     }
     if(choice == "Empty")
     {
       list.appendChild(document.createTextNode("No Skills"));
     }
     {% for spec in skills.keys() %}
     if(choice == "{{spec}}")
     {
       var div = document.createElement("div");
       {% for element in skills[spec] %}
       var tempbutton = document.createElement("input");
        tempbutton.setAttribute("type", "radio");
        tempbutton.setAttribute("id", "skillchoice");
        tempbutton.setAttribute("name", "skillchoice");
        tempbutton.setAttribute("value", "{{element}}");
        var templabel = document.createElement("label");
        templabel.appendChild(document.createTextNode("{{element}}"));
        div.appendChild(tempbutton);
        div.appendChild(templabel);
        {% endfor %}
        list.appendChild(div);


        }
        {% endfor %}
        }




    function setEnsSkillchoice(x)
    {
      var choice = x.value;
      var myTable = document.getElementById('ensignTable');
      var list = myTable.rows[1].cells[8];
      while (list.hasChildNodes()) {
        list.removeChild(list.firstChild);
      }
      if(choice == "Empty")
      {
        list.appendChild(document.createTextNode("No Skills"));
      }
      {% for spec in skills.keys() %}
      if(choice == "{{spec}}")
      {
        var div = document.createElement("div");
        {% for element in skills[spec] %}
        var tempbutton = document.createElement("input");
         tempbutton.setAttribute("type", "radio");
         tempbutton.setAttribute("id", "skillchoiceens");
         tempbutton.setAttribute("name", "skillchoiceens");
         tempbutton.setAttribute("value", "{{element}}");
         var templabel = document.createElement("label");
         templabel.appendChild(document.createTextNode("{{element}}"));
         div.appendChild(tempbutton);
         div.appendChild(templabel);
         {% endfor %}
         list.appendChild(div);


       }
       {% endfor %}
       }




    // shamelessly stolen from http://shebang.brandonmintern.com/foolproof-html-escaping-in-javascript/
    // One hopes tis indeed foolproof.
    // Use the browser's built-in functionality to quickly and safely escape
    // the string
    function escapeHTML(str)
    {
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
    }



   function validate()
   {

   if(total < 0)
   {
   alert("Insufficient funds!")
   return false
   }

   if((document.getElementById('bandnametext').value) == "")
   {
   alert("Please name your Warband!")
   return false

   }

    return true

   }


   function doFormSubmit(total)
   {
     method =  "post"; // Set method to post by default if not specified.

      //band validation
      if(!(validate()))
      {
      return
      }


     var form = document.createElement("form");
     form.setAttribute("method", method);
     form.setAttribute("action", "/edit/{{ band['Name'] }}");

     console.log(total)

     var remainingGold = document.createElement("input");
     remainingGold.setAttribute("type", "hidden");
     remainingGold.setAttribute("name", "remainingGold");
     remainingGold.setAttribute("value", total);
     form.appendChild(remainingGold);

     var bandname = document.createElement("input");
     bandname.setAttribute("type", "hidden");
     bandname.setAttribute("name", "bandname");
     bandname.setAttribute("value", escapeHTML(document.getElementById('bandnametext').value));
     form.appendChild(bandname);
     var capspec = document.createElement("input");
     capspec.setAttribute("type", "hidden");
     capspec.setAttribute("name", "capspec");
     capspec.setAttribute("value", document.getElementById('capspecsel').value);
     form.appendChild(capspec);
     //start
     var capmove = document.createElement("input");
     capmove.setAttribute("type", "hidden");
     capmove.setAttribute("name", "capmove");
     capmove.setAttribute("value", 5);
     form.appendChild(capmove);
     var capfight = document.createElement("input");
     capfight.setAttribute("type", "hidden");
     capfight.setAttribute("name", "capfight");
     capfight.setAttribute("value", document.getElementById('capfig').value);
     form.appendChild(capfight);
     var capshoot = document.createElement("input");
     capshoot.setAttribute("type", "hidden");
     capshoot.setAttribute("name", "capshoot");
     capshoot.setAttribute("value", document.getElementById('capsho').value);
     form.appendChild(capshoot);
     var capshield = document.createElement("input");
     capshield.setAttribute("type", "hidden");
     capshield.setAttribute("name", "capshield");
     capshield.setAttribute("value", 12);
     form.appendChild(capshield);
     var capmorale = document.createElement("input");
     capmorale.setAttribute("type", "hidden");
     capmorale.setAttribute("name", "capmorale");
     capmorale.setAttribute("value", document.getElementById('capmor').value);
     form.appendChild(capmorale);
     var caphealth = document.createElement("input");
     caphealth.setAttribute("type", "hidden");
     caphealth.setAttribute("name", "caphealth");
     caphealth.setAttribute("value", document.getElementById('caphea').value);
     form.appendChild(caphealth);
     var capexperience = document.createElement("input");
     capexperience.setAttribute("type", "hidden");
     capexperience.setAttribute("name", "capexperience");
     capexperience.setAttribute("value", document.getElementById('capexp').value);
     form.appendChild(capexperience);
     //end


    var capweap_array = []
          {% for weap in weaps %}

            if(document.getElementById("{{weap}}_check").checked)
            {
             var weapon = "{{weap}}"
             //sum += {{weaps[weap]}};
             capweap_array.push(weapon)
            }


           {% endfor %}

           console.log(capweap_array)

     var capweap = document.createElement("input");
            capweap.setAttribute("type", "hidden");
            capweap.setAttribute("name", "capweap");
            capweap.setAttribute("value", JSON.stringify(capweap_array));
            form.appendChild(capweap);

     var capskills = []
     var capskillarr =  document.getElementsByName("capskil");
     for(k=0;k<capskillarr.length;k++)
     {
       if (capskillarr[k].checked)
       {
         capskills.push(capskillarr[k].value);
       }
     }
     var capskill = document.createElement("input");
     capskill.setAttribute("type", "hidden");
     capskill.setAttribute("name", "capskill");
     capskill.setAttribute("value", JSON.stringify(capskills));
     form.appendChild(capskill);
     if (engHire)
     {
       var hasensign = document.createElement("input");
       hasensign.setAttribute("type", "hidden");
       hasensign.setAttribute("name", "hasensign");
       hasensign.setAttribute("value", engHire);
       form.appendChild(hasensign);
       var ensspec = document.createElement("input");
       ensspec.setAttribute("type", "hidden");
       ensspec.setAttribute("name", "ensspec");
       ensspec.setAttribute("value", document.getElementById('ensskillsel').value);
       form.appendChild(ensspec);

       //start

       if(hadEnsign){

       var enmove = document.createElement("input");
       enmove.setAttribute("type", "hidden");
       enmove.setAttribute("name", "ensmove");
       enmove.setAttribute("value", 7);
       form.appendChild(enmove);
       var enfight = document.createElement("input");
       enfight.setAttribute("type", "hidden");
       enfight.setAttribute("name", "ensfight");
       enfight.setAttribute("value", document.getElementById('enfig').value);
       form.appendChild(enfight);
       var enshoot = document.createElement("input");
       enshoot.setAttribute("type", "hidden");
       enshoot.setAttribute("name", "ensshoot");
       enshoot.setAttribute("value", document.getElementById('ensho').value);
       form.appendChild(enshoot);
       var enshield = document.createElement("input");
       enshield.setAttribute("type", "hidden");
       enshield.setAttribute("name", "ensshield");
       enshield.setAttribute("value", 10);
       form.appendChild(enshield);
       var enmorale = document.createElement("input");
       enmorale.setAttribute("type", "hidden");
       enmorale.setAttribute("name", "ensmorale");
       enmorale.setAttribute("value", document.getElementById('enmor').value);
       form.appendChild(enmorale);
       var enhealth = document.createElement("input");
       enhealth.setAttribute("type", "hidden");
       enhealth.setAttribute("name", "enshealth");
       enhealth.setAttribute("value", document.getElementById('enhea').value);
       form.appendChild(enhealth);
       var enexperience = document.createElement("input");
       enexperience.setAttribute("type", "hidden");
       enexperience.setAttribute("name", "ensexperience");
       enexperience.setAttribute("value", document.getElementById('enexp').value);
       form.appendChild(enexperience);
       }
       else
       {
       var enmove = document.createElement("input");
       enmove.setAttribute("type", "hidden");
       enmove.setAttribute("name", "ensmove");
       enmove.setAttribute("value", 7);
       form.appendChild(enmove);
       var enfight = document.createElement("input");
       enfight.setAttribute("type", "hidden");
       enfight.setAttribute("name", "ensfight");
       enfight.setAttribute("value", 0);
       form.appendChild(enfight);
       var enshoot = document.createElement("input");
       enshoot.setAttribute("type", "hidden");
       enshoot.setAttribute("name", "ensshoot");
       enshoot.setAttribute("value", -1);
       form.appendChild(enshoot);
       var enshield = document.createElement("input");
       enshield.setAttribute("type", "hidden");
       enshield.setAttribute("name", "ensshield");
       enshield.setAttribute("value", 10);
       form.appendChild(enshield);
       var enmorale = document.createElement("input");
       enmorale.setAttribute("type", "hidden");
       enmorale.setAttribute("name", "ensmorale");
       enmorale.setAttribute("value", 2);
       form.appendChild(enmorale);
       var enhealth = document.createElement("input");
       enhealth.setAttribute("type", "hidden");
       enhealth.setAttribute("name", "enshealth");
       enhealth.setAttribute("value", 8);
       form.appendChild(enhealth);
       var enexperience = document.createElement("input");
       enexperience.setAttribute("type", "hidden");
       enexperience.setAttribute("name", "ensexperience");
       enexperience.setAttribute("value", 0);
       form.appendChild(enexperience);
       }
       //end
       if (hadEnsign)
       {
         var ensskills = []
         var ensskillarr =  document.getElementsByName("ensskil");
         for(k=0;k<ensskillarr.length;k++)
         {
           if (ensskillarr[k].checked)
           {
             ensskills.push(ensskillarr[k].value);
           }
         }

         var ensskill = document.createElement("input");
         ensskill.setAttribute("type", "hidden");
         ensskill.setAttribute("name", "ensskill");
         ensskill.setAttribute("value", JSON.stringify(ensskills));
         form.appendChild(ensskill);
       }


     var ensweap_array = []
    {% for weap in weaps %}

      if(document.getElementById("{{weap}}_ens_check").checked)
      {
       var weapon = "{{weap}}"
       ensweap_array.push(weapon)
      }


     {% endfor %}

     console.log(ensweap_array)

     var ensweap = document.createElement("input");
     ensweap.setAttribute("type", "hidden");
     ensweap.setAttribute("name", "ensweap");
     ensweap.setAttribute("value", JSON.stringify(ensweap_array));
     form.appendChild(ensweap);


     }

     var troopsarr = []
     for(i = 1; i < 9; i++)
     {
       var selector = document.getElementById('troop'+i);
       troopsarr.push(selector.value);
     }
     var troops = document.createElement("input");
     troops.setAttribute("type", "hidden");
     troops.setAttribute("name", "troops");
     troops.setAttribute("value", JSON.stringify(troopsarr));
     form.appendChild(troops);


     console.log('form submit success!')
     document.body.appendChild(form);
     form.submit();
   }



    </script>
    </html>
